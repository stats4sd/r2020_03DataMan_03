---
title: "Manipulating Data using dplyr: Quiz & Exercises"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: paged
runtime: shiny_prerendered
description: >
  Learn to manipulate data with the package dplyr.
---

```{r setup, include=FALSE}
library(learnr)
library(dplyr)
tutorial_options(exercise.timelimit = 10)
options(max.print=200, dplyr.summarise.inform = FALSE)
imdb <- readRDS("imdb2020.RDS")
```



## Quiz

*Question 1*

```{r Q1, echo=FALSE}
question("What dplyr function is used to create or modify columns of a dataset?",
  answer("select()"),
  answer("filter()"),
  answer("arrange()"),
  answer("summarize()"),
  answer("mutate()",correct=TRUE),
  answer("group_by()"), allow_retry = TRUE,random_answer_order = TRUE
)
```

*Question 2*

```{r Q2, echo=FALSE}
question("Which dplyr functions could be responsible for having an output with fewer columns than the original dataset? (select ALL that apply)",
  answer("select()", correct = TRUE),
  answer("filter()"),
  answer("arrange()"),
  answer("summarize()", correct = TRUE),
  answer("mutate()"),
  answer("group_by()"), allow_retry = TRUE,random_answer_order = TRUE
)
```

*Question 3*

```{r Q3, echo=FALSE}
question("Which of these commands is correct, if I want to retrieve the entries of type movie",
  answer("filter(imdb, Type==`movie`)"),
  answer("filter(imdb, type==`movie`)", correct = TRUE),
  answer("filter(imdb, Type=`movie`)"),
  answer("filter(imdb, type=`movie`)"), allow_retry = TRUE,random_answer_order = TRUE
)
```

*Question 4*

```
group_by(imdb, year)
summarize(imdb_grouped, meanVotes = mean(numVotes))


```

```{r Q4, echo=FALSE}
question("What should I add to the above command to obtain the average number of votes by year",
  answer("`arrange(numVotes)` in between the two functions"),
  answer("`ungroup(imdb_grouped)` after the function summarize()"),
  answer("`imdb_grouped <-` in front of the function group_by()", correct=TRUE),
  answer("`%>%` after the function group_by()"), allow_retry = TRUE,random_answer_order = TRUE
)
```




## Exercises



**Exercise 1. Identify and correct the four mistakes that I made in the command below, to obtain the median duration of all the movies released after the year 2000**

```{r ex1,exercise=TRUE,error=TRUE}
imdb %>%
  filter(imdb, type="movie" & year>2000) %>%
  sumarize(medianDuration = median(length)
```

```{r ex1-solution}
imdb %>%
  filter(type=="movie" & year>2000) %>%
  summarize(medianDuration = median(length))

# 1- either imdb should be removed from filter, or the first line should be deleted
# 2- the condition of the filter function needs a double equals
# 3- the function summarize was misspelled
# 4- the parenthesis of the function summarize was not closed
```



**Exercise 2. Who is the current youngest director in the dataset?**

```{r ex2,exercise=TRUE,error=TRUE}

```

```{r ex2-solution}

# without pipe
arrange(imdb, birthYear)

# with pipe
imdb %>% arrange(birthYear)

# to help reading the output, it's a good idea to combine the command with a select():
imdb %>% 
  arrange(birthYear) %>% 
  select(director, birthYear)

```





**Exercise 3. Which are the first released titles for each type of entry**

```{r ex3, exercise=TRUE}

```

```{r ex3-solution}
imdb %>% 
  group_by(type) %>%
  filter(year==min(year))
```



**Exercise 4. What are the 5 best rated thriller tvSeries having more than 10000 votes**

```{r ex4,exercise=TRUE}

```

```{r ex4-solution}
imdb %>%
  filter(thriller=="TRUE" & type=="tvSeries" & numVotes>10000) %>%
  arrange(desc(averageRating))
```




**Exercise 5. What are the minimum, average and maximum age of a movie director releasing a movie in the imdb dataset? (you will need to use `na.rm=T` to deal with the entries where the year of birth of the director is missing)**

```{r ex5,exercise=TRUE}

```

```{r ex5-solution}
imdb %>%
  mutate(age=year-birthYear) %>%
  filter(type=="movie") %>%
  summarize(minAge=min(age, na.rm=T), meanAge=mean(age, na.rm=T), maxAge=max(age, na.rm=T))

```



**Exercise 6. (SUPER CRAZY HARD!) find the 9 directors having released their 5th movie at the youngest age. Who is ranked 6th in the list? (hint: you may need to use a function that we haven't seen yet: slice(). Use google to find out what it does do and how to use it.**

```{r ex6,exercise=TRUE}

```


```{r ex6-solution}
imdb %>%
  filter(type=="movie") %>%
  mutate(age=year-birthYear) %>%
  group_by(director) %>% 
  arrange(age) %>%
  slice(5) %>%
  ungroup() %>%
  arrange(age) %>%
  select(director, age, title) %>%
  slice(1:9)
```


Solutions to these exercises will be made available when the next module of the course becomes live. Check the course site for details.


## Appendix: 'imdb' dataset

For this session, we are using a dataset called "imdb", which we constructed from the subsets of the Internet Movie Database made available for non-commercial purposes by the IMDb team:
<a href="https://www.imdb.com/interfaces/" target="_blank">https://www.imdb.com/interfaces/</a>


It contains the following informations for all the entries having more than 500 votes, that are not of type "tvEpisodes" and for which information about year of release, running time and director(s) was available at the time of extraction (28/09/2020):  


```{r, echo=FALSE,message=FALSE,warning=FALSE}
library(knitr)
data.frame(Column=c("title","type","year","length","numVotes","averageRating","director","birthYear","animation","action", "adventure", "comedy", "documentary", "fantasy", "romance", "sci_fi", "thriller"),
           Description=c("popular title of the entry",
                         "type of entry: movie, short, tvMiniSeries, tvMovie, tvSeries, tvShort, tvSpecial, video or videoGame",
                         "year of release (for series, year of release of the first episode)",
                         "duration in minutes",
                         "number of votes for the entry",
                         "IMDb's weighted average rating for the entry",
                         "director of the entry (if multiple directors, the first one was picked)",
                         "year of birth of the director",
                        "the entry is of genre animation (TRUE/FALSE)",
                        "the entry is of genre action (TRUE/FALSE)",
                        "the entry is of genre adventure (TRUE/FALSE)",
                        "the entry is of genre comedy (TRUE/FALSE)",
                        "the entry is of genre documentary (TRUE/FALSE)",
                        "the entry is of genre fantasy (TRUE/FALSE)",
                        "the entry is of genre romance (TRUE/FALSE)",
                        "the entry is of genre science fiction (TRUE/FALSE)",
                        "the entry is of genre thriller (TRUE/FALSE)")) %>% kable()

```


The dataset has 61,776 rows. It's too much to be displayed here. Below are 50 arbitrary rows though. Spend a bit of time familiarising yourself with the columns of this dataset. You can use the arrow keys to scroll right and left.

```{r,echo=FALSE}
DT::datatable(imdb[c(1:50)*1000,])

```

## Appendix: Useful reference links  


The official dplyr documentation: <a href="https://dplyr.tidyverse.org/" target="_blank">https://dplyr.tidyverse.org/</a> 

dplyr CheatSheet:<a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf" target="_blank">https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf   </a>  

Data Manipulation Tools - Rstudio video:
<a href="https://www.youtube.com/watch?v=Zc_ufg4uW4U" target="_blank">https://www.youtube.com/watch?v=Zc_ufg4uW4U   </a> 

Some documentation on subsetting r-objects using base-R: <a href="https://bookdown.org/rdpeng/rprogdatascience/subsetting-r-objects.html" target="_blank">https://bookdown.org/rdpeng/rprogdatascience/subsetting-r-objects.html </a> 
